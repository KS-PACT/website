<!doctype html>
<html>
  <head>
    <title>Software</title>
    <link rel="stylesheet" type="text/css" href="/css/common.css" />
  </head>
  <body>
    <%- include header.ejs %>
		<div class="container">
			<div id = "alert_placeholder"></div>
		</div>
		<% for(var i=0; i<data.length; i++) { %>
			<div class="w3-card-4" onclick="location.href='<%= data[i].link %>';" >
				<% if(!data[i].picture){ %>
					<div class="card-image opt-image" style="background-color:<%= data[i].color %>">
					</div>
				<% } else { %>
					<div class="card-image opt-image">
						<img src=<%= data[i].picture %> />
					</div>
				<% } %>
				<div class="w3-container w3-left">
					<h3><%= data[i].name %></h3>
				</div>
				<% if(priv == 'Admin'){ %>
					<div class="decision-buttons">
						<button class="btn btn-danger remove-btn" type="button" data-id="<%= data[i].id %>">
							Remove
						</button>
					</div>
				<% } %>
			</div>
    <% } %>
		
		<% if(priv == 'Admin'){ %>
			<div class="w3-card-4" onclick="location.href='software_add';">
				<div class="card-image">
					<img src="images/defaults/add_button.png" />
				</div>
			</div>
		<% } %>
		
		<script type="text/javascript">
			// Send data to server functions
			function removeSoftware(id) {
				$.ajax({
					type: 'post',
					url: '/software',
					data: { 'action': 'remove', 'id': id },
					dataType: "json",
					success: function (data) {
						console.log("Status: ", data.status);
						if(data.status == "Success") {
							bootstrap_alert.success('You correctly removed a software resource.');
						}
						else {
							bootstrap_alert.error(data.status);
						}
					},
					error: function (xhr, status, err) {
						console.error('text status '+status+', err '+err);
					}
				});
			}

			// Handle notifications
			bootstrap_alert = function() {}
			bootstrap_alert.success = function(message) {
				$('#alert_placeholder').html('<div class="alert alert-success"><strong>Success!</strong><span> '+message+'</span></div>');
			}
			bootstrap_alert.error = function(message) {
				$('#alert_placeholder').html('<div class="alert alert-danger"><strong>Error:</strong><span> '+message+'</span></div>');
			}

			// Handle on click event functions
			$('.remove-btn').on('click', function() {
				console.log("Remove button was clicked");
				
				event.cancelBubble = true;
				if(event.stopPropagation) event.stopPropagation();
				
				removeSoftware($(this).data("id"));
			});
		</script>
  </body>
</html>
